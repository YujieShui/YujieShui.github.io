---
title: JVM-JVM中内存区域划分
toc: true
categories:
  - Java
  - JVM
tags:
  - java
  - jvm
abbrlink: 3860d841
date: 2019-09-12 16:07:13
---

在[JVM-Java中的类加载机制](https://shuiyujie.com/post/5e4eb5a4.html)一文中，我讲述了 Java 类加载的过程，它包含加载、验证、准备、解析、初始化、使用、卸载这几个步骤。我们在准备阶段会将类加载到内存中，为类变量分配内存并赋予初值；在初始化阶段则会正式执行初始化代码。

**那么在准备阶段和初始化阶段，JVM 具体是怎么为类分配内存的呢？**

<!-- more -->

# 什么是 JVM 中的内存区域划分

当 JVM 运行我们的代码时，它会使用多块不同的内存，不同的内存存放不同的数据，再配合代码的执行流程，这样就能把程序运行起来了。

![JVM内存区域](http://image.shuiyujie.com/2019-09-12-21-12-10.png)

概括来讲 JVM 中的内存空间可以分成三大块：

- 存放加载的类。保存 JVM 加载的类。
- 运行方法使用。保存程序时我们要执行一个个方法，即方法中的局部变量。
- 创建的对象。保存运行程序时创建的对象。

# JVM 中的内存区域划分

JVM 的内存划分可以分成三大块：存放加载的类，存放创建的对象，运行方法时使用。如果进一步细分，可以分成这样几个主要区域：方法区、程序计数器、Java虚拟机栈和 Java堆。

![JVM内存区域划分示例](http://image.shuiyujie.com/2019-09-12-21-20-50.png)

如果存在 main() 函数，JVM 会从 main() 函数开始完成整个类加载过程，所以上面这段代码会从 main() 开始加载。JVM 进行会启动，先加载 Kafka.java 到内存中，然后有一个 main 进程开始执行 main() 方法：

![JVM内存区域划分](http://image.shuiyujie.com/2019-09-12-21-44-18.png)

- 方法区：会加载  Kafka 和 ReplicaManager 这两个类
- 字节码执行引擎：class 文件是一个个字节码，JVM 将会使用**字节码执行引擎**执行代码指令。
- 程序计数器：用程序计数器来标记代码指令执行到哪一行。
- 多线程：JVM是支持多线程的，可能开启多个线程来执行代码指令，每一个线程都有自己的程序计数器
- Java虚拟机栈：保存方法内的局部变量等数据，线程每执行一个方法，就会对这个方法调用创建对应的一个栈帧
- Java 堆内存：new 出来的实例对象将会保存在 Java 堆内存中，栈帧中的局部变量将会指向 Java 堆中的实例对象。